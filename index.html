<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Hosting - iceinstitut</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://iceinstitut.github.io/image/bootstrap.css" rel="stylesheet">
  <!-- Bootstrap Icon -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>
<body class="bg-light py-4">
  <div class="container">
    <h1 class="mb-4 text-center">üìÅ Daftar Gambar di Repository</h1>
    <p class="text-center">Klik tombol <i class="bi bi-clipboard-fill"></i> untuk menyalin URL gambar ke clipboard.</p>
    <div class="mb-3">
  <input type="text" id="search-input" class="form-control" placeholder="üîç Cari nama file...">
</div>
<p id="total-count" class="text-muted small">Memuat data...</p>

    <div id="image-list" class="row row-cols-2 row-cols-sm-2 row-cols-md-4 g-3"></div>
    <nav>
  <ul id="pagination" class="pagination justify-content-center mt-4"></ul>
</nav>

  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

  <script>
const repoOwner = 'iceinstitut';
const repoName = 'image';
const folderPath = 'aset';
const imagesPerPage = 12;
let currentPage = 1;
let allImages = [];

document.getElementById('search-input').addEventListener('input', () => {
  currentPage = 1;
  renderImages();
});

function fetchImages() {
  fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`)
    .then(response => response.json())
    .then(files => {
      allImages = files.filter(file =>
        file.type === 'file' && /\.(png|jpe?g|gif|webp|svg)$/i.test(file.name)
      );
      renderImages();
    })
    .catch(err => {
      document.getElementById('image-list').innerHTML = `
        <div class="alert alert-danger" role="alert">
          Gagal memuat gambar. Pastikan repo public dan tidak kosong.
        </div>
      `;
      console.error(err);
    });
}

function renderImages() {
  const container = document.getElementById('image-list');
  container.innerHTML = '';

  const query = document.getElementById('search-input').value.toLowerCase();
  const filtered = allImages.filter(img => img.name.toLowerCase().includes(query));

  const totalPages = Math.ceil(filtered.length / imagesPerPage); // ‚¨ÖÔ∏è Pindahkan ini ke atas
  const startIndex = (currentPage - 1) * imagesPerPage;
  const endIndex = Math.min(startIndex + imagesPerPage, filtered.length);

  // ‚úÖ Update jumlah total yang ditampilkan
  document.getElementById("total-count").textContent = 
    `Menampilkan ${endIndex - startIndex} dari ${filtered.length} gambar (halaman ${currentPage} dari ${totalPages || 1})`;

  const paginated = filtered.slice(startIndex, endIndex);

  paginated.forEach((file, index) => {
    const rawUrl = `https://${repoOwner}.github.io/${repoName}/${folderPath}/${file.name}`;
    const inputId = `input-url-${index}`;
    const fileExt = file.name.split('.').pop();
    const fileSize = formatSize(file.size);

    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/commits?path=${file.path}`)
      .then(res => res.json())
      .then(commits => {
        const latestCommit = commits[0];
        const commitDate = new Date(latestCommit.commit.author.date);
        const formattedDate = commitDate.toLocaleString('id-ID', {
          dateStyle: 'medium',
          timeStyle: 'short',
          timeZone: 'Asia/Jakarta'
        });

        const col = document.createElement('div');
        col.className = 'col-md-6 col-lg-4';

        col.innerHTML = `
          <div class="card shadow-sm h-100">
            <div class="d-flex align-items-center justify-content-center p-3" style="height: 250px;">
              <img loading="lazy" src="${rawUrl}" alt="${file.name}" class="img-fluid mh-100">
            </div>
            <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>${file.name}</strong></li>
                <li class="list-group-item"><strong>Ekstensi:</strong> .${fileExt}</li>
                <li class="list-group-item"><strong>Ukuran:</strong> ${fileSize}</li>
                <li class="list-group-item"><strong>Update Terakhir:</strong> ${formattedDate}</li>
              </ul>
            </div>
            <div class="card-footer">
              <div class="input-group">
                <button class="btn btn-outline-primary"
                        type="button"
                        onclick="copyToClipboard('${inputId}', this)"
                        data-bs-toggle="tooltip"
                        data-bs-placement="bottom"
                        title="Copy URL">
                  <i class="bi bi-clipboard-fill"></i>
                </button>
                <input type="text" class="form-control" id="${inputId}" value="${rawUrl}" disabled readonly onclick="this.select()">
              </div>
            </div>
          </div>
        `;
        container.appendChild(col);

        // Inisialisasi tooltip ulang
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el));
      });
  });

  renderPagination(totalPages);
}

function renderPagination(totalPages) {
  const pagination = document.getElementById('pagination');
  pagination.innerHTML = '';

  if (totalPages <= 1) return;

  const prev = document.createElement('li');
  prev.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
  prev.innerHTML = `<a class="page-link" href="#">‚Üê Prev</a>`;
  prev.onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      renderImages();
    }
  };
  pagination.appendChild(prev);

  for (let i = 1; i <= totalPages; i++) {
    const pageItem = document.createElement('li');
    pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
    pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
    pageItem.onclick = () => {
      currentPage = i;
      renderImages();
    };
    pagination.appendChild(pageItem);
  }

  const next = document.createElement('li');
  next.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
  next.innerHTML = `<a class="page-link" href="#">Next ‚Üí</a>`;
  next.onclick = () => {
    if (currentPage < totalPages) {
      currentPage++;
      renderImages();
    }
  };
  pagination.appendChild(next);
}

function copyToClipboard(inputId, button) {
  const input = document.getElementById(inputId);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");

  const original = button.innerHTML;
  button.innerHTML = "<i class='bi bi-check-lg'></i>";
  button.classList.remove("btn-outline-primary");
  button.classList.add("btn-success");

  setTimeout(() => {
    button.innerHTML = original;
    button.classList.add("btn-outline-primary");
    button.classList.remove("btn-success");
  }, 1500);
}

function formatSize(bytes) {
  if (bytes < 1024) return `${bytes} B`;
  else if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
  else return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;
}

fetchImages();
</script>

</body>
</html>
